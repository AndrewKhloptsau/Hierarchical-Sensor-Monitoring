function getMimeType(n){let i=getExtensionFromName(n),t=mimeTypesMap.get(i);return t===undefined&&(t="text/html"),t}function getExtensionFromName(n){let t=n.indexOf(".");return t===-1?n:n.substring(t+1,n.length)}function viewFile(n,t,i){let r=getMimeType(t);$.ajax({type:"POST",url:i+"?Selected="+n,cache:!1,contentType:"application/json",success:function(n){r===undefined&&(r="text/html");let t=new Blob([n],{type:r}),i=window.URL.createObjectURL(t);window.open(i)}})}function Data(n,t,i,r){return{To:n,From:t,Type:i,Path:r}}function deleteSensor(){let n=this.id.substring(21);$.ajax({type:"POST",url:removeSensorAction+"?Selected="+n,contentType:"application/json",dataType:"html",cache:!1,async:!0})}function displayList(n){$('[id^="list_"]').css("display","none");$('[id^="sensorData_"]').css("display","none");$("#noData").css("display","none");hideSensorInfoParentBlocks();let t=n.node.id;if(t.startsWith("sensor_")){let n=t.substring(7),i=$("#sensorData_"+n)[0];$("#sensorData_"+n).css("display","block");$("#sensorInfo_parent_"+n).css("display","block");let r=i.parentNode;r.style.display="block";$("#"+n).click()}else{hideSensorInfoParentBlocks();let i=t,n="#list_"+i;$(n).css("display","block");showAllChildAccordionsById(n)}}function showAllChildAccordionsById(n){let t=$(n)[0];if(t!=undefined){let n=t.childNodes;console.log(n);n.forEach(n=>{n.classList.contains("accordion")&&(n.style.display="block")})}}function hideSensorInfoParentBlocks(){$('[id^="sensorInfo_parent_"]').css("display","none")}function displayGraph(n,t,i,r){let f=convertToGraphData(n,t,r),u=getPreviousZoomData(i);if(u===undefined||u===null)Plotly.newPlot(i,f);else{let n=createLayoutFromZoomData(u);Plotly.newPlot(i,f,n)}let e=document.getElementById(i);e.on("plotly_relayout",function(n){window.sessionStorage.setItem(i,JSON.stringify(n))})}function createLayoutFromZoomData(n){let t=Object.values(JSON.parse(n));return{xaxis:{range:[t[0],t[1]]},yaxis:{range:[t[2],t[3]]}}}function getPreviousZoomData(n){return window.sessionStorage.getItem(n)}function convertToGraphData(n,t,i){let r=JSON.parse(n),u,e,f;switch(t){case"0":return u=getBoolData(r),f=getTimeList(r),getSimpleGraphData(f,u,"bar");case"1":return u=getIntegersData(r),f=getTimeList(r),getSimpleGraphData(f,u,"scatter");case"2":return u=getDoublesData(r),f=getTimeList(r),getSimpleGraphData(f,u,"scatter");case"4":return e=getDeserializedBarsData(r),createBarGraphData(e,i);case"5":return e=getDeserializedBarsData(r),createBarGraphData(e,i);default:return undefined}}function getPlotType(n){return n===1||n===2?"scatter":n===4||n===5?"box":undefined}function initializeInfoLinks(){$('[id^="sensorInfo_link_"]').off("click").on("click",metaInfoLinkClicked)}function metaInfoLinkClicked(){let n=this.id.substring(16);$("#sensor_info_"+n).is(":empty")?showMetaInfo(n):hideMetaInfo(n)}function showMetaInfo(n){$.ajax({type:"GET",url:getSensorInfoAction+"?Path="+n,dataType:"html",contentType:"application/json",cache:!1,async:!0}).done(function(t){$("#sensor_info_"+n).empty().append(JSON.parse(t).value);setLinkText(n,"Hide meta info");initializeEditInfoButtons(n)})}function hideMetaInfo(n){$("#sensor_info_"+n).empty();setLinkText(n,"Show meta info")}function setLinkText(n,t){let i=document.getElementById("sensorInfo_link_"+n);i.textContent=t}function initializeEditInfoButtons(n){$("#editInfo_"+n).on("click",editInfoButtonClick);$("#revertInfo_"+n).on("click",revertInfoClick);$("#saveInfo_"+n).on("click",saveInfoClick)}function editInfoButtonClick(){let n=this.id.substring(9);$("#interval_"+n).removeAttr("disabled");$("#description_"+n).removeAttr("disabled");$("#saveInfo_"+n).removeAttr("disabled");$("#revertInfo_"+n).removeAttr("disabled")}function revertInfoClick(){let n=this.id.substring(11);reloadInfo(n)}function saveInfoClick(){let n=this.id.substring(9),t=getDescription(n),i=getInterval(n),r=Info(t,i,n);saveSensorInfo(r)}function saveSensorInfo(n){$.ajax({type:"POST",data:JSON.stringify(n),url:updateSensorInfoAction,contentType:"application/json",dataType:"html",cache:!1,async:!0}).done(function(){reloadInfo(n.EncodedPath)})}function Info(n,t,i){return{Description:n,ExpectedUpdateInterval:t,EncodedPath:i}}function getDescription(n){return $("#description_"+n).val()}function getInterval(n){return $("#interval_"+n).val()}function reloadInfo(n){let t=document.getElementById("sensorInfo_link_"+n);t.click();t.click()}function initializeTree(){$("#jstree").jstree({core:{check_callback:!0,themes:{name:"proton",responsive:!0}},contextmenu:{items:function(n){var t=$("#jstree").jstree(!0);return{Delete:{separator_before:!1,separator_after:!1,label:"Delete",action:function(){$("#modalDeleteLabel").empty();$("#modalDeleteLabel").append("Remove node");$("#modalDeleteBody").empty();$("#modalDeleteBody").append('Do you really want to remove "'+n.text+'" node?');var i=new bootstrap.Modal(document.getElementById("modalDelete"));i.show();$("#confirmDeleteButton").on("click",function(){i.hide();$.ajax({type:"POST",url:removeNode+"?Selected="+n.id,dataType:"html",contentType:"application/json",cache:!1,async:!0}).done(function(){t.delete_node(n.id);$("#list_"+n.id).remove();$("#noData").css("display","block")})});$("#closeDeleteButton").on("click",function(){i.hide()})}}}}},plugins:["state","contextmenu","themes","wholerow"]});$("#updateTime").empty();$("#updateTime").append("Update Time: "+(new Date).toUTCString());initializeClickTree()}function initializeClickTree(){$("#jstree").on("activate_node.jstree",function(n,t){t!=undefined&&t.node!=undefined&&t.node.id!=undefined&&displayList(t)})}const mimeTypesMap=new Map;mimeTypesMap.set("html","text/html");mimeTypesMap.set("pdf","application/pdf");var millisecondsInHour=36e5,millisecondsInDay=millisecondsInHour*24;Date.prototype.AddDays=function(n){let t=new Date(this.valueOf());return t.setDate(t.getDate()+n),t};Date.prototype.AddHours=function(n){let t=new Date(this.valueOf());return t.setHours(t.getHours()+n),t};{function c(){$('[id^="collapse"]').off("show.bs.collapse").on("show.bs.collapse",function(){let n=this.id.substring(9),t=getTypeForSensor(n),i=new Date;isGraphAvailable(t)?initializeGraph(n,rawHistoryLatestAction,t,Data(i,i,t,n),!0):initializeTable(n,historyLatestAction,t,Data(i,i,t,n),!0)});r();n();$('[id^="button_view"]').on("click",function(){id=this.id.substring(12,this.id.length);fileType=document.getElementById("fileType_"+id).value;viewFile(id,fileType,viewFileAction)});$('[id^="button_download"]').on("click",function(){id=this.id.substring(16,this.id.length);window.location.href=getFileAction+"?Selected="+id})}function n(){$('[id^="link_graph_"]').off("click").on("click",t);$('[id^="link_table_"]').off("click").on("click",i)}function t(){let n=this.id.substring(11),t=getTypeForSensor(n);const{from:i,to:r}=getFromAndTo(n);let u=Data(r,i,t,n),f=isAllHistorySelected(n)?rawHistoryAllAction:rawHistoryAction;initializeGraph(n,f,t,u,!1)}function i(){let n=this.id.substring(11),t=getTypeForSensor(n);const{from:i,to:r}=getFromAndTo(n);let u=Data(r,i,t,n),f=isAllHistorySelected(n)?historyAllAction:historyAction;initializeTable(n,f,t,u,!1)}function r(){$('[id^="radio_hour_"]').off("click").on("click",u);$('[id^="radio_day_"]').off("click").on("click",f);$('[id^="radio_three_days_"]').off("click").on("click",e);$('[id^="radio_week_"]').off("click").on("click",o);$('[id^="radio_month_"]').off("click").on("click",s);$('[id^="radio_all_"]').off("click").on("click",h);$('[id^="button_export_csv_"]').off("click").on("click",exportCsv);$('[id^="button_delete_sensor_"]').off("click").on("click",deleteSensor)}function u(){let n=this.id.substring(11),t=getTypeForSensor(n);const i=new Date,r=i.AddHours(-1);requestHistory(n,historyAction,rawHistoryAction,t,Data(i,r,t,n))}function f(){let n=this.id.substring(10),t=getTypeForSensor(n);const i=new Date,r=i.AddDays(-1);requestHistory(n,historyAction,rawHistoryAction,t,Data(i,r,t,n))}function e(){let n=this.id.substring(17),t=getTypeForSensor(n);const i=new Date,r=i.AddDays(-3);requestHistory(n,historyAction,rawHistoryAction,t,Data(i,r,t,n))}function o(){let n=this.id.substring(11),t=getTypeForSensor(n);const i=new Date,r=i.AddDays(-7);requestHistory(n,historyAction,rawHistoryAction,t,Data(i,r,t,n))}function s(){let n=this.id.substring(12),t=getTypeForSensor(n);const i=new Date,r=i.AddDays(-30);requestHistory(n,historyAction,rawHistoryAction,t,Data(i,r,t,n))}function h(){let n=this.id.substring(10),t=getTypeForSensor(n);requestHistory(n,historyAllAction,rawHistoryAllAction,t,{})}}{function i(i,r,u,f,e){if(!isGraphAvailable(f)){n(i,r,f,e,!1);return}isTableHistorySelected(i)?n(i,r,f,e,!1):t(i,u,f,e,!1)}function r(){let n=this.id.substring(18),t=getTypeForSensor(n);if(isAllHistorySelected(n)){window.location.href=exportHistoryAllAction+"?Path="+n+"&Type="+t;return}const{from:i,to:r}=getFromAndTo(n);window.location.href=exportHistoryAction+"?Path="+n+"&Type="+t+"&From="+i.toISOString()+"&To="+r.toISOString()}function n(n,t,i,r,u){$.ajax({type:"POST",data:JSON.stringify(r),url:t+"?Path="+n+"&Type="+i,contentType:"application/json",dataType:"html",cache:!1,async:!0}).done(function(t){$(`#values_${n}`).empty();let i=JSON.parse(t).value;if(i===""){$("#history_"+n).hide();$("#no_data_"+n).show();return}$("#history_"+n).show();$("#no_data_"+n).hide();$(`#values_${n}`).append(i);u&&selectRadioForTable(n)})}function t(n,t,i,r,u){$.ajax({type:"POST",data:JSON.stringify(r),url:t+"?Path="+n+"&Type="+i,contentType:"application/json",dataType:"html",cache:!1,async:!0}).done(function(t){if(JSON.parse(t).length===0){$("#history_"+n).hide();$("#no_data_"+n).show();return}$("#history_"+n).show();$("#no_data_"+n).hide();let r="graph_"+n;u&&selectAppropriateRadio(t,n);displayGraph(t,i,r,n)})}}{function i(i){let r=new Date(Date.parse((new Date).toUTCString())),u=t(i),f=r-u;n(f,i)}function t(n){let t=$("#oldest_date_"+n).val();return new Date(Date.parse(t))}function r(t,i){let r=JSON.parse(t),u=new Date(Date.parse((new Date).toUTCString())),f=new Date(Date.parse(r[0].time)),e=u-f;n(e,i)}function n(n,t){if(n<=millisecondsInHour){$("#radio_hour_"+t).prop("checked",!0);return}if(n<=millisecondsInDay){$("#radio_day_"+t).prop("checked",!0);return}if(n<=3*millisecondsInDay){$("#radio_three_days_"+t).prop("checked",!0);return}if(n<=7*millisecondsInDay){$("#radio_week_"+t).prop("checked",!0);return}if(n<=30*millisecondsInDay){$("#radio_month_"+t).prop("checked",!0);return}$("#radio_all_"+t).prop("checked",!0)}function u(n){return!(n==="3"||n==="6"||n==="7")}function f(n){let t=$("#values_parent_"+n);return t.hasClass("show")}function e(n){return $("#radio_all_"+n).is(":checked")}function o(n){let i=null,t=null;return $("#radio_hour_"+n).is(":checked")&&(t=new Date,i=t.AddHours(-1)),$("#radio_day_"+n).is(":checked")&&(t=new Date,i=t.AddDays(-1)),$("#radio_three_days_"+n).is(":checked")&&(t=new Date,i=t.AddDays(-3)),$("#radio_week_"+n).is(":checked")&&(t=new Date,i=t.AddDays(-7)),$("#radio_month_"+n).is(":checked")&&(t=new Date,i=t.AddDays(-30)),{from:i,to:t}}function s(n){let t=$("#inputCount_"+n).val();return t===undefined&&(t=10),t}function h(n){return $("#sensor_type_"+n).val()}}{function n(n){return n.map(function(n){let t=JSON.parse(n.typedData).BoolValue===!0;return t?1:0})}}{function n(n,t,i){return[{x:n,y:t,type:i}]}function t(n){return n.map(function(n){return JSON.parse(n.typedData).IntValue})}function i(n){return n.map(function(n){return JSON.parse(n.typedData).DoubleValue})}function r(n){return n.map(function(n){return n.time})}}{function t(n){return n.map(function(n){return JSON.parse(n.typedData)})}function n(n){return n.map(function(n){return n.EndTime.startsWith("0001")?n.StartTime:n.EndTime})}function i(t,i){let r=getBarsMax(t),u=getBarsMin(t),f=getBarsMedian(t),e=getBarsQ1(t),o=getBarsQ3(t),s=getBarsMean(t),h=n(t);return[{type:"box",name:i,q1:e,median:f,q3:o,mean:s,lowerfence:u,upperfence:r,x:h}]}{function n(n){return n.map(function(n){return n.Min})}function t(n){return n.map(function(n){return n.Max})}function i(n){let t=[];return n.map(function(n){n.Percentiles.filter(n=>n.Percentile===.5).map(function(n){t.push(n.Value)})}),t}function r(n){let t=[];return n.map(function(n){n.Percentiles.filter(n=>n.Percentile===.25).map(function(n){t.push(n.Value)})}),t}function u(n){let t=[];return n.map(function(n){n.Percentiles.filter(n=>n.Percentile===.75).map(function(n){t.push(n.Value)})}),t}function f(n){return n.map(function(n){return n.Mean})}}}